
@using Proyecto.BO
@using System.Data
@model DataTable
@{
    Layout = null;
}

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="../../assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Todo Protegido SOS</title>

   

    <!-- Bootstrap core CSS     -->
    <link href="~/Content/assets_tablanet/css/bootstrap.min.css" rel="stylesheet" />
    <!--  Light Bootstrap Dashboard core CSS    -->
    <link href="~/Content/assets_tablanet/css/light-bootstrap-dashboard.css" rel="stylesheet" />
    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="~/Content/assets_tablanet/css/demo.css" rel="stylesheet" />
    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="~/Content/assets_tablanet/css/pe-icon-7-stroke.css" rel="stylesheet" />

</head>
<body>
    <form id="frmlistapuntos">
        <div class="wrapper">
            <div class="sidebar" data-color="azure" data-image="../../assets/img/full-screen-image-3.jpg">
                <!--

                    Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
                    Tip 2: you can also add an image using data-image tag

                -->

                <div class="logo">
                    <a href="#" class="simple-text logo-mini">
                        TP
                    </a>

                    <a href="#" class="simple-text logo-normal">
                        Todo Protegido SOS
                    </a>
                </div>

                <div class="sidebar-wrapper">
                    <div class="user">
                        <div class="info">
                            @if (ViewBag.usuario != null)
                            {
                                <div class="photo">
                                    <img src=@ViewBag.usuario.foto width="100%" height="100%" />
                                </div>

                                <a data-toggle="collapse" href="#collapseExample" class="collapsed">
                                    <span>
                                        @ViewBag.usuario.nombre

                                    </span>
                                </a>
                            }


                            @*@RenderSection("Sideusu", required: true)*@
                        </div>
                    </div>

                    <ul class="nav">
                        <li>
                            <a href="~/VBackend/estadisticas">
                                <i class="pe-7s-global"></i>
                                <p>Inicio</p>
                            </a>
                        </li>
                        <li>


                            <a href="~/VBackend/Mapa_admin">
                                <i class="pe-7s-map-2"></i>
                                <p>Mapa</p>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="collapse" href="#tablesExamples">
                                <i class="pe-7s-map-marker"></i>
                                <p>
                                    Gestion de Puntos
                                    <b class="caret"></b>
                                </p>
                            </a>
                            <div class="collapse" id="tablesExamples">
                                <ul class="nav">
                                    <li class="active">
                                        <a href="#">
                                            <span class="sidebar-mini"><i class="pe-7s-like2"></i></span>
                                            <span class="sidebar-normal">Aprobar Puntos</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="~/VBackend/PuntosAprovados">
                                            <span class="sidebar-mini"><i class="pe-7s-check"></i></span>
                                            <span class="sidebar-normal">Puntos Aprobados</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="~/VBackend/PuntosD">
                                            <span class="sidebar-mini"><i class="pe-7s-junk"></i></span>
                                            <span class="sidebar-normal">Puntos desaprobados</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a data-toggle="collapse" href="#tablesExamples1">
                                <i class="pe-7s-config"></i>
                                <p>
                                    Configuración
                                    <b class="caret"></b>
                                </p>
                            </a>
                            <div class="collapse" id="tablesExamples1">
                                <ul class="nav">

                                    <li>
                                        <a href="~/VBackend/ConfiguracionIndex">
                                            <span class="sidebar-mini"><i class="pe-7s-home"></i></span>
                                            <span class="sidebar-normal">Index</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    

                        <li>
                            <a data-toggle="collapse" href="#tablesExamples3">
                                <i class="pe-7s-graph2"></i>
                                <p>
                                    Reportes
                                    <b class="caret"></b>
                                </p>
                            </a>
                            <div class="collapse" id="tablesExamples3">
                                <ul class="nav">

                                    <li>
                                        <a href="~/VBackend/Reporte_peligros">
                                            <span class="sidebar-mini"><i class="pe-7s-graph1"></i></span>
                                            <span class="sidebar-normal">Reporte de incidencias</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="~/VBackend/reporte_usuarios">
                                            <span class="sidebar-mini"><i class="pe-7s-portfolio"></i></span>
                                            <span class="sidebar-normal">Reporte de usuarios</span>
                                        </a>
                                    </li>


                                </ul>
                            </div>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="main-panel">
                <nav class="navbar navbar-default">
                    <div class="container-fluid">

                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="#">Aprobar Puntos</a>
                        </div>
                        @using (Html.BeginForm("cerrar_sesion", "usuariofron", FormMethod.Post))
                        {
                            <div class="collapse navbar-collapse">
                                <ul class="nav navbar-nav navbar-right">
                                    <li>
                                        <button type="submit" class="btn btn-link btn-simple text-danger">
                                            <i class="pe-7s-power"></i>
                                            Cerrar Sesión
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        }
                      
                    </div>
                </nav>



                <div class="main-content">
                    <div class="container-fluid">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="content">
                                        <div class="toolbar">
                                            <!--        Here you can write extra buttons/actions for the toolbar              -->
                                        </div>
                                        <div class="fresh-datatables">
                                            <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>Imagen</th>
                                                        <th>Tipo de Peligro</th>
                                                        <th>Zona</th>
                                                        <th>Creador</th>
                                                        <th>Fecha</th>
                                                   
                                                        <th>Comentario</th>
                                                        <th class="disabled-sorting text-left">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tfoot>
                                                    <tr>
                                                        <th>Imagen</th>
                                                        <th>Tipo de Peligro</th>
                                                        <th>Zona</th>
                                                        <th>Creador</th>
                                                        <th>Fecha</th>
                                                      
                                                        <th>Comentario</th>
                                                        <th class="text-center">Acciones</th>
                                                    </tr>
                                                </tfoot>
                                                <tbody>
                                                    @foreach (DataRow row1 in Model.Rows)
                                                    {
                                                        <tr>
                                                            <td style="width:200px;">
                                                                <center>
                                                                    <div class="img-container">
                                                                        <img src=@row1["imagen"] style="width:200px; height:200px; border-radius:25px;" />
                                                                    </div>
                                                                </center>
                                                            </td>
                                                            <td style="width:90px;">@row1["Peligro"]</td>
                                                            <td style="width:80px;">@row1["Zona"]</td>
                                                            <td style="width:80px;">@row1["Nombre"]</td>
                                                            <td style="width:80px;">@Convert.ToDateTime(row1["Fecha"]).ToLongDateString()</td>
                                                            <td style="width:230px;">@row1["comentario"]</td>
                                                            <td  style="width:25px;">

                                                                
                                                                <a href="#" onclick="confirmar(@row1["ID"],this)" style="cursor:pointer" class="btn btn-round  btn-success btn-fill pull-center"><i class="fa fa-check-square"></i></a>
                                                                
                                                            </td>
                                                            <td style="width:25px;">
                                                                <form id="idp"><a href="#" onclick="negar(@row1["ID"],this)" style="cursor:pointer" id="btnid" class="btn btn-round  btn-danger btn-fill pull-center"><i class="fa fa-window-close"></i></a></form>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div><!-- end content-->
                                </div><!--  end card  -->
                            </div> <!-- end col-md-12 -->
                        </div> <!-- end row -->

                    </div>
                </div>

                <footer class="footer">
                    <div class="container-fluid">
                        <nav class="pull-left">


                        </nav>
                        <p class="copyright pull-right">
                            &copy;
                            <script>document.write(new Date().getFullYear())</script> <a href="#">Todo Protegido SOS</a>, lo mejor en seguridad
                        </p>
                    </div>
                </footer>
            </div>
        </div>

        <script>
            var tem;
            var r
            function negar(id,rn) {
                 r = rn;
                 idpun=id;
                 tem = id;
                
                swal({
                    title: "¿Cancelar incidencia?",
                    icon: "warning",
                    buttons: ["Cancelar", "Aceptar"],
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                           
                                $("#mensajemodal").modal('show');
                            
                            
                            

                           
                            //actualizar_apro(id);
                            //$(document).ready(function () {
                            
                            //});
                        } else {
                            
                        }
                    });
            }
        function confirmar(id,r) {
            swal({
                title: "¿Aprobar esta incidencia?",
                icon: "warning",
                buttons: ["Cancelar", "Aceptar"],
                dangerMode: true,
            })
                .then((willDelete) => {
                    if (willDelete) {
                        actualizar_apro(id,r);
                    } else {
                       
                    }
                });
        }
        function actualizar_apro(id,r) {
            $.ajax({
                url: 'Actualizar_apro/',
                type: "POST",
                data: $("#frp").serialize(),
                data: { id: id }
            }).done(function () {
                $().load('/VBackend/ListaDePuntosM')
                swal("La solicitud se realizó con éxito!", {
                    icon: "success",
                    button: "Aceptar",
                    
                }).then((willDelete) => {
                    if (willDelete) {
                        borrar(r);
                    } else {

                    }
                });
               
            })

        }

        function borrar(r) {
            r.closest('tr').remove();
        }


        function actualizar_den() {
            var mensaje = document.getElementsByName("verificar123")[0].value;
            $.ajax({
                url: 'Actualizar_den/',
               
                data: { id: tem, mensaje: mensaje }
            }).done(function () {
                $().load('/VBackend/ListaDePuntosM')
                swal("La solicitud se realizó con éxito!", {
                    icon: "success",
                    button: "Aceptar",
                }).then((willDelete) => {
                    if (willDelete) {
                        borrar(r);
                    } else {

                    }
                });
            })

        }
        </script>


        <div class="modal fade" id="mensajemodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog" >
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title title" id="exampleModalLabel">Motivo de cancelación  </h4>
                    </div>
                    <div class="modal-body">
                        <form id="frp">
                            <div class="form-group">
                                <textarea class="form-control" style = "resize:none;"  rows="10" name="verificar123"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-wd" data-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-success btn-wd" onclick="actualizar_den()" data-dismiss="modal">Aceptar</button>
                    </div>
                </div>
               
            </div>
        </div>


        
       



    </form>
</body>

<!--   Core JS Files  -->


<script src="~/Content/assets_tablanet/js/jquery.min.js"></script>
<script src="~/Content/assets_tablanet/js/bootstrap.min.js"></script>
<script src="~/Content/assets_tablanet/js/perfect-scrollbar.jquery.min.js"></script>


<!--  Forms Validations Plugin -->

<script src="~/Content/assets_tablanet/js/jquery.validate.min.js"></script>

<!--  Plugin for Date Time Picker and Full Calendar Plugin-->


<script src="~/Content/assets_tablanet/js/moment.min.js"></script>
<!--  Date Time Picker Plugin is included in this js file -->
<script src="~/Content/assets_tablanet/js/bootstrap-datetimepicker.min.js"></script>



<!--  Select Picker Plugin -->
<script src="~/Content/assets_tablanet/js/bootstrap-selectpicker.js"></script>


<!--  Checkbox, Radio, Switch and Tags Input Plugins -->
<script src="~/Content/assets_tablanet/js/bootstrap-switch-tags.min.js"></script>


<!--  Charts Plugin -->
<script src="~/Content/assets_tablanet/js/chartist.min.js"></script>


<!--  Notifications Plugin    -->
<script src="~/Content/assets_tablanet/js/bootstrap-notify.js"></script>


<!-- Sweet Alert 2 plugin -->

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


<!-- Vector Map plugin -->
<script src="~/Content/assets_tablanet/js/jquery-jvectormap.js"></script>


<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAs7jfgdjycxSiEuTEFihYlhC5dkAQZuFE"></script>

<!-- Wizard Plugin    -->
<script src="~/Content/assets_tablanet/js/jquery.bootstrap.wizard.min.js"></script>

<!--  Bootstrap Table Plugin    -->
<script src="~/Content/assets_tablanet/js/bootstrap-table.js"></script>


<!--  Plugin for DataTables.net  -->
<script src="~/Content/assets_tablanet/js/jquery.datatables.js"></script>


<!--  Full Calendar Plugin    -->
<script src="~/Content/assets_tablanet/js/fullcalendar.min.js"></script>


<!-- Light Bootstrap Dashboard Core javascript and methods -->
<script src="~/Content/assets_tablanet/js/light-bootstrap-dashboard.js"></script>


<!--   Sharrre Library    -->
<script src="~/Content/assets_tablanet/js/jquery.sharrre.js"></script>


<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="~/Content/assets_tablanet/js/demo.js"></script>


<script type="text/javascript">
    $(document).ready(function () {
        $('#datatables').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Todo"]],
            responsive: true,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Buscar",
            }

        });


        var table = $('#datatables').DataTable();

        // Edit record
        table.on('click', '.edit', function () {
            $tr = $(this).closest('tr');

            if ($tr.hasClass('child')) {
                $tr = $tr.prev('.parent');
            }

            var data = table.row($tr).data();
            alert('You press on Row: ' + data[0] + ' ' + data[1] + ' ' + data[2] + '\'s row.');
        });

        // Delete a record
        table.on('click', '.remove', function (e) {
            $tr = $(this).closest('tr');
            table.row($tr).remove().draw();
            e.preventDefault();
        });

        //Like record
        table.on('click', '.like', function () {
            alert('You clicked on Like button');
        });
    });




 
</script>













</html>
